<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Torrent Manager</title>
    <link rel="stylesheet" href="style.css?v={{ version }}">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <!-- Enhanced Liquid Glass Filter Definition with RGB Channel Separation -->
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;" aria-hidden="true">
        <defs>
            <filter id="liquid-glass" x="-20%" y="-20%" width="140%" height="140%" color-interpolation-filters="sRGB">
                <!-- Dynamic displacement map will be injected here via JavaScript -->
                <feImage id="glass-displacement-map" result="map" href="data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' preserveAspectRatio='none'%3E%3Cdefs%3E%3ClinearGradient id='r' x1='0' x2='1' y1='0' y2='0'%3E%3Cstop offset='0' stop-color='%23000'/%3E%3Cstop offset='1' stop-color='%23f00'/%3E%3C/linearGradient%3E%3ClinearGradient id='b' x1='0' x2='0' y1='0' y2='1'%3E%3Cstop offset='0' stop-color='%23000'/%3E%3Cstop offset='1' stop-color='%2300f'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23r)'/%3E%3Crect width='100%25' height='100%25' fill='url(%23b)' style='mix-blend-mode:difference'/%3E%3C/svg%3E" />
                
                <!-- RED channel with strongest displacement -->
                <feDisplacementMap
                    id="redchannel"
                    in="SourceGraphic"
                    in2="map"
                    scale="-180"
                    xChannelSelector="R"
                    yChannelSelector="G"
                    result="dispRed"
                />
                <feColorMatrix
                    in="dispRed"
                    type="matrix"
                    values="1 0 0 0 0
                            0 0 0 0 0
                            0 0 0 0 0
                            0 0 0 1 0"
                    result="red"
                />
                
                <!-- GREEN channel (reference / least displaced) -->
                <feDisplacementMap
                    id="greenchannel"
                    in="SourceGraphic"
                    in2="map"
                    scale="-170"
                    xChannelSelector="R"
                    yChannelSelector="G"
                    result="dispGreen"
                />
                <feColorMatrix
                    in="dispGreen"
                    type="matrix"
                    values="0 0 0 0 0
                            0 1 0 0 0
                            0 0 0 0 0
                            0 0 0 1 0"
                    result="green"
                />
                
                <!-- BLUE channel with medium displacement -->
                <feDisplacementMap
                    id="bluechannel"
                    in="SourceGraphic"
                    in2="map"
                    scale="-160"
                    xChannelSelector="R"
                    yChannelSelector="G"
                    result="dispBlue"
                />
                <feColorMatrix
                    in="dispBlue"
                    type="matrix"
                    values="0 0 0 0 0
                            0 0 0 0 0
                            0 0 1 0 0
                            0 0 0 1 0"
                    result="blue"
                />
                
                <!-- Blend channels back together -->
                <feBlend in="red" in2="green" mode="screen" result="rg" />
                <feBlend in="rg" in2="blue" mode="screen" result="output" />
                
                <!-- Final blur for smoothness -->
                <feGaussianBlur in="output" stdDeviation="0.7" />
            </filter>
        </defs>
    </svg>

    <div class="container">
        <header class="header">
            <h1>üì• Torrent Manager {{ version }}</h1>
            <div class="refresh-indicator" id="refreshIndicator">
                <span class="refresh-dot" id="connectionDot"></span>
                <span id="connectionStatus">Connecting...</span>
            </div>
        </header>
        
        <div class="stats-bar" id="statsBar">
            <div class="stat-item">
                <span class="stat-label">Total:</span>
                <span class="stat-value" id="totalTorrents">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Downloading:</span>
                <span class="stat-value downloading" id="downloadingCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Seeding:</span>
                <span class="stat-value seeding" id="seedingCount">0</span>
            </div>
        </div>
        
        <div class="filter-bar" id="filterBar">
            <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">All</button>
            <button class="filter-btn" data-filter="movies" onclick="setFilter('movies')">Movies</button>
            <button class="filter-btn" data-filter="tv_shows" onclick="setFilter('tv_shows')">TV Shows</button>
            <button class="filter-btn" data-filter="other" onclick="setFilter('other')">Other</button>
        </div>
        
        <div class="torrents-container" id="torrentsContainer">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Loading torrents...</p>
            </div>
            <div class="error" id="error" style="display: none;">
                <p>‚ùå Failed to connect</p>
                <button class="retry-btn" onclick="connectWebSocket()">Retry</button>
            </div>
            <div class="torrents-list" id="torrentsList"></div>
        </div>
    </div>
    
    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu" style="display: none;">
        <div class="context-menu-item" data-action="pause">
            <span class="context-menu-icon">‚è∏Ô∏è</span>
            <span>Pause</span>
        </div>
        <div class="context-menu-item" data-action="resume">
            <span class="context-menu-icon">‚ñ∂Ô∏è</span>
            <span>Resume</span>
        </div>
        <div class="context-menu-item" data-action="files">
            <span class="context-menu-icon">üìÅ</span>
            <span>View Files</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item danger" data-action="delete">
            <span class="context-menu-icon">üóëÔ∏è</span>
            <span>Delete</span>
        </div>
    </div>
    
    <!-- File List Modal -->
    <div class="modal-overlay" id="fileModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="fileModalTitle">Torrent Files</h2>
                <button class="modal-close" onclick="closeFileModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="file-list" id="fileList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading files...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal" style="display: none;">
        <div class="modal-content small">
            <div class="modal-header">
                <h2>Delete Torrent</h2>
                <button class="modal-close" onclick="closeDeleteModal()">√ó</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this torrent?</p>
                <label class="checkbox-label">
                    <input type="checkbox" id="deleteFiles">
                    <span>Also delete downloaded files</span>
                </label>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>
    
    <script src="app.js?v={{ version }}"></script>
</body>
</html>

